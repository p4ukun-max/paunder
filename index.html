<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>HeartChat RPG ‚Äî Tinder Style</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:Inter,system-ui,Arial;
  background:#000;
  display:flex;
  justify-content:center;
}

/* APP */
.app{
  width:100%;
  max-width:420px;
  height:100vh;
  background:#000;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  color:white;
}

/* HEADER */
header{
  padding:14px;
  color:#fff;
  font-weight:700;
  text-align:center;
}

/* DECK */
.deck{
  flex:1;
  position:relative;
  overflow:hidden;
}

/* CARD */
.card{
  position:absolute;
  inset:10px;
  border-radius:18px;
  overflow:hidden;
  background:#111;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
  touch-action:none;
  transition:transform .3s ease, opacity .3s ease;
}

/* IMAGE */
.card img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* OVERLAY */
.overlay{
  position:absolute;
  inset:0;
  background:linear-gradient(
    to top,
    rgba(0,0,0,.85) 20%,
    rgba(0,0,0,.2) 55%,
    rgba(0,0,0,0) 75%
  );
  color:#fff;
  padding:16px;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
}

.name{
  font-size:1.4rem;
  font-weight:800;
}

.distance{
  font-size:.85rem;
  opacity:.8;
  margin:4px 0;
}

.bio{
  font-size:.95rem;
  opacity:.9;
}

/* CONTROLS */
.controls{
  padding:18px 0 26px;
  display:flex;
  justify-content:center;
  gap:26px;
}

.circle-btn{
  width:64px;
  height:64px;
  border-radius:50%;
  border:none;
  font-size:1.6rem;
  cursor:pointer;
}

.skip{background:#222;color:#ff4458}
.star{background:#222;color:#3b82f6}
.like{background:#222;color:#22c55e}

/* BADGES */
.badge{
  position:absolute;
  top:24px;
  padding:6px 12px;
  font-weight:800;
  border-radius:8px;
  opacity:0;
}

.like-badge{left:20px;background:#22c55e}
.skip-badge{right:20px;background:#ff4458}

/* STACK */
.card[data-i="1"]{transform:scale(.97) translateY(8px);opacity:.9}
.card[data-i="2"]{transform:scale(.94) translateY(16px);opacity:.8}

/* CHAT */
#chatList{
  display:none;
  flex-direction:column;
  flex:1;
  overflow-y:auto;
  background:#111;
}
.chatItem{
  display:flex;
  padding:10px;
  border-bottom:1px solid #222;
  cursor:pointer;
}
.chatItem img{
  width:40px;
  height:40px;
  border-radius:50%;
  margin-right:10px;
}
.chatItem .info{
  flex:1;
}
.chatItem .name{
  font-weight:bold;
}
.chatItem .lastMsg{
  font-size:0.85rem;
  opacity:0.7;
}

#chatWindow{
  display:none;
  flex-direction:column;
  flex:1;
  background:#111;
}
#chatMsgs{
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.msg{
  margin:6px 0;
  padding:6px 10px;
  border-radius:12px;
  max-width:70%;
}
.msg.yo{
  background:#22c55e;
  align-self:flex-end;
}
.msg.ella{
  background:#333;
  align-self:flex-start;
}
#chatOpciones{
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:10px;
}
#chatInputWrapper{
  display:flex;
  padding:10px;
}
#chatInput{
  flex:1;
  padding:6px 10px;
  border-radius:12px;
  border:none;
}
#sendBtn{
  padding:6px 12px;
  margin-left:6px;
  border:none;
  border-radius:12px;
  background:#22c55e;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="app">

<header>HeartChat RPG</header>

<div class="deck" id="deck">
  <div class="badge like-badge" id="likeBadge">LIKE</div>
  <div class="badge skip-badge" id="skipBadge">NOPE</div>
</div>

<div class="controls">
  <button class="circle-btn skip" id="btnSkip">‚úï</button>
  <button class="circle-btn star">‚òÖ</button>
  <button class="circle-btn like" id="btnLike">‚ô•</button>
</div>

<!-- Lista de chats estilo WhatsApp -->
<div id="chatList"></div>

<!-- Ventana de chat -->
<div id="chatWindow">
  <div id="chatHeader" style="padding:10px;font-weight:bold;"></div>
  <div id="chatMsgs"></div>
  <div id="chatOpciones"></div>
  <div id="chatInputWrapper">
    <input id="chatInput" placeholder="Escribe...">
    <button id="sendBtn">Enviar</button>
  </div>
</div>

</div>

<script>
/* ===================== DATOS ===================== */
const PERSONAJES=[
  {name:"Leonardo", age:27, distance:"4 km", bio:"Me gusta practicar deporte y voy a menudo al gimnasio", img:"gympau.png"},
  {name:"Camila", age:25, distance:"2 km", bio:"Amo el arte y viajar por el mundo", img:"camila.png"},
  {name:"Sofia", age:22, distance:"3 km", bio:"Fan de Netflix y los gatos üê±", img:"sofia.png"}
];

/* Elecciones RPG */
const eleccionesRPG = [
  {
    pregunta: "¬øQu√© te gusta hacer el fin de semana?",
    opciones: [
      { texto: "Ir al gimnasio üí™", efecto: 10 },
      { texto: "Quedarme en casa üõãÔ∏è", efecto: -5 },
      { texto: "Salir con amigos üçª", efecto: 5 },
    ]
  },
  {
    pregunta: "¬øCu√°l es tu comida favorita?",
    opciones: [
      { texto: "Pizza üçï", efecto: 5 },
      { texto: "Ensalada ü•ó", efecto: 2 },
      { texto: "Carne asada ü•©", efecto: 8 },
    ]
  }
];

/* ===================== VARIABLES ===================== */
const deck=document.getElementById("deck");
const likeBadge=document.getElementById("likeBadge");
const skipBadge=document.getElementById("skipBadge");

const chatList = document.getElementById("chatList");
const chatWindow = document.getElementById("chatWindow");
const chatHeader = document.getElementById("chatHeader");
const chatMsgs = document.getElementById("chatMsgs");
const chatOpciones = document.getElementById("chatOpciones");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");

let matches = [];
let chatActual = null;

/* ===================== FUNCIONES ===================== */
function createCard(p){
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
    <img src="${p.img}">
    <div class="overlay">
      <div class="name">${p.name}, ${p.age}</div>
      <div class="distance">${p.distance} away</div>
      <div class="bio">${p.bio}</div>
    </div>`;
  deck.appendChild(c);
  drag(c);
}

function drag(card){
  let startX=0, dx=0;

  card.onpointerdown=e=>{
    startX=e.clientX;
    card.setPointerCapture(e.pointerId);
  };

  card.onpointermove=e=>{
    dx=e.clientX-startX;
    card.style.transform=`translateX(${dx}px) rotate(${dx/15}deg)`;
    likeBadge.style.opacity=dx>0?Math.min(dx/120,1):0;
    skipBadge.style.opacity=dx<0?Math.min(-dx/120,1):0;
  };

  card.onpointerup=()=>{
    if(dx>120) swipe(card,1);
    else if(dx<-120) swipe(card,-1);
    else{
      card.style.transform="";
      likeBadge.style.opacity=0;
      skipBadge.style.opacity=0;
    }
    dx=0;
  };
}

function swipe(card,dir){
  card.style.transform=`translateX(${dir*800}px) rotate(${dir*25}deg)`;
  card.style.opacity=0;

  if(dir===1){
    const nombre = card.querySelector(".name").innerText;
    crearMatch(nombre);
  }

  setTimeout(()=>card.remove(),300);
}

document.getElementById("btnLike").onclick=()=>{
  const c=document.querySelector(".card");
  if(c) swipe(c,1);
};
document.getElementById("btnSkip").onclick=()=>{
  const c=document.querySelector(".card");
  if(c) swipe(c,-1);
};

/* ===================== MATCHES ===================== */
function crearMatch(nombre){
  const perfil = PERSONAJES.find(p=>`${p.name}, ${p.age}`===nombre);
  if(!perfil) return;

  const chat = {
    nombre: perfil.name,
    img: perfil.img,
    interes: 50,
    mensajes: [],
    estado: "activo"
  };
  matches.push(chat);
  guardarProgreso();
  renderChatList();
  abrirChat(chat);
}

/* ===================== CHAT LIST ===================== */
function renderChatList(){
  chatList.style.display="flex";
  chatList.innerHTML="";
  matches.forEach(c=>{
    const div = document.createElement("div");
    div.className="chatItem";
    div.innerHTML=`<img src="${c.img}"><div class="info"><div class="name">${c.nombre}</div><div class="lastMsg">${c.mensajes.slice(-1)[0]?.texto || ""}</div></div>`;
    div.onclick=()=>abrirChat(c);
    chatList.appendChild(div);
  });
}

/* ===================== ABRIR CHAT ===================== */
function abrirChat(chat){
  chatActual = chat;
  deck.style.display="none";
  chatList.style.display="none";
  chatWindow.style.display="flex";
  chatHeader.innerText = chat.nombre;
  renderMensajes();
}

/* ===================== RENDER MENSAJES ===================== */
function renderMensajes(){
  chatMsgs.innerHTML="";
  chatActual.mensajes.forEach(m=>{
    const div=document.createElement("div");
    div.className="msg "+m.autor;
    div.innerText=m.texto;
    chatMsgs.appendChild(div);
  });
  chatMsgs.scrollTop = chatMsgs.scrollHeight;
}

/* ===================== ELECCIONES RPG ===================== */
let eleccionesPendientes = [...eleccionesRPG];
function mostrarEleccion(e){
  chatOpciones.innerHTML = "";
  e.opciones.forEach(o=>{
    const btn = document.createElement("button");
    btn.innerText = o.texto;
    btn.onclick = ()=>{
      chatActual.interes += o.efecto;
      chatActual.mensajes.push({autor:"yo", texto:o.texto});
      renderMensajes();
      chatOpciones.innerHTML="";
      setTimeout(respuestaAuto, Math.random()*2000+1000);
      guardarProgreso();
    };
    chatOpciones.appendChild(btn);
  });
}

/* ===================== RESPUESTA AUTOMATICA ===================== */
function respuestaAuto(){
  if(chatActual.estado!=="activo") return;

  // ghosting
  if(chatActual.interes<=0){ chatActual.estado="ghost"; chatActual.mensajes.push({autor:"ella", texto:"..."}); renderMensajes(); return; }

  let texto;
  if(chatActual.interes>70) texto="Me caes muy bien üòè";
  else if(chatActual.interes<30) texto="ok";
  else texto="Jajaja üòÑ";

  chatActual.mensajes.push({autor:"ella", texto});
  renderMensajes();

  // elecciones RPG
  const next = eleccionesPendientes.shift();
  if(next) mostrarEleccion(next);
  guardarProgreso();
}

/* ===================== INPUT MENSAJE ===================== */
sendBtn.onclick=()=>{
  const txt = chatInput.value.trim();
  if(!txt) return;
  chatActual.mensajes.push({autor:"yo", texto:txt});
  evaluarMensaje(txt);
  chatInput.value="";
  renderMensajes();
  setTimeout(respuestaAuto, Math.random()*1000+1000);
  guardarProgreso();
};

function evaluarMensaje(txt){
  if(txt.toLowerCase().includes("hola")) chatActual.interes+=5;
  else if(txt.toLowerCase().includes("gym")) chatActual.interes+=8;
  else if(txt.length<3) chatActual.interes-=5;
  else chatActual.interes+=2;
}

/* ===================== LOCALSTORAGE ===================== */
function guardarProgreso(){
  localStorage.setItem("heartChat", JSON.stringify({matches, eleccionesPendientes}));
}

function cargarProgreso(){
  const data = localStorage.getItem("heartChat");
  if(!data) return;
  const saved = JSON.parse(data);
  matches = saved.matches || [];
  eleccionesPendientes = saved.eleccionesPendientes || [...eleccionesRPG];
  if(matches.length>0){
    renderChatList();
  }
}

/* ===================== INICIO ===================== */
PERSONAJES.forEach(createCard);
cargarProgreso();
</script>

</body>
</html>
